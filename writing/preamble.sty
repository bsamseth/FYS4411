\ProvidesPackage{preamble}
\usepackage[utf8]{inputenc}    % Allow non-English characters.
\usepackage[T1]{fontenc}       % Allow special glyphs, such as รถ.
\usepackage{listings}          % Code listings.
\usepackage{hyperref}          % Links.
\usepackage[capitalise]{cleveref}          % Links.
\crefname{appsec}{Appendix}{Appendices}


\usepackage[hyperref, backend=biber, backref, backrefstyle=none, sorting=none]{biblatex}
   \addbibresource{references.bib}

\usepackage{amsmath, amssymb, amsthm} % Enhanced math formatting
\usepackage{mathtools}
\usepackage{bm}                % Bold math symbols, \bm{}.
\usepackage{wasysym}           % More symbols.
% \usepackage{enumitem}          % Control symbol in enumerate.
\usepackage{physics}           % All sorts of short hands for physics.
\usepackage{cancel}            % Cancel expressions + cancelto.
\usepackage{siunitx}           % Formating of numbers with units.
    \DeclareSIUnit\gauss{G}
    \DeclareSIUnit{\au}{a.u.}
    \sisetup{exponent-product = \cdot}	    % Dot as multiplication symbol (not cross).
 	% \sisetup{separate-uncertainty = true} 	% Use pluss-minus form for uncertainty.
\usepackage{tikz}
\usetikzlibrary{shapes, calc, shapes, arrows, positioning, decorations.markings, external}
\tikzexternalize[prefix=figures/]
\usepackage{pgfplots}
\usepgfplotslibrary{groupplots}
\usepackage{booktabs}
\usepackage[symbol]{footmisc}
\usepackage{csquotes}
\usepackage{perpage}
\usepackage{dirtytalk}
\MakePerPage{footnote}

\usepackage[chapter]{algorithm}
\usepackage{algpseudocode}
%% Example code
% \begin{algorithm}
%     \caption{Variational Monte Carlo Algorithm}\label{alg:vmc-general-alg}
%     \begin{algorithmic}
%         \Procedure{VMC}{$\hat H, \psi_{\vb\alpha}$}
%             \State $r\gets a$
%         \EndProcedure
%     \end{algorithmic}
% \end{algorithm}
\newcommand{\Yield}{\textbf{yield} }

% \newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}{Definition}[section]


\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}
\renewcommand{\vec}[1]{\bm{#1}}
\renewcommand{\vb}[1]{\bm{#1}}
\newcommand{\mat}[1]{\bm{#1}}
\newcommand{\vx}{\vec{x}}
\newcommand{\vX}{\mat{X}}
\newcommand{\vy}{\vec{y}}
\newcommand{\vY}{\mat{Y}}
\newcommand{\valpha}{\vec{\alpha}}
\newcommand{\psialpha}{\psi_{\valpha}}
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\Expect}{\operatorname{E}}
\newcommand{\Std}{\operatorname{Std}}
\newcommand{\SE}{\operatorname{SE}}


\newcommand{\centerthis}[1]{\makebox[\textwidth]{#1}}  % Attempt to make the argument centered.
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}  % Number equations in align*.

% Fractions with display style in both numerator and denominator
\newcommand\ddfrac[2]{\frac{\displaystyle #1}{\displaystyle #2}}

\newcommand{\sepanswer}{\vspace{0.5cm}\hrule\vspace{0.5cm}}

% Change default numbering of equations, figures and tables.
% \renewcommand{\thesubsection}{\thesection.\arabic{subsection}} % Subsection 1.1, 1.2,...
% \renewcommand{\thesubsection}{\thesection.\alph{subsection})}  % subsection is now 1.a), 1.b), ...
% \numberwithin{equation}{subsection} % Number equations within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
% \numberwithin{figure}{subsection} % Number figures within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)
% \numberwithin{table}{subsection} % Number tables within sections (i.e. 1.1, 1.2, 2.1, 2.2 instead of 1, 2, 3, 4)

\newcommand{\horline}{\begin{center}\line(1,0){350}\end{center}} % Quick separating line across the page.

\newcommand{\intfy}{\int_{-\infty}^{\infty}}   % Quick infinity integrals
\newcommand{\intzfy}{\int_0^\infty}
\newcommand{\anti}[1]{\overline{#1}} % Wrapper for overline.
\newcommand{\divides}{\mid}
\newcommand{\notdivides}{\nmid}
\newcommand{\defeq}{\vcentcolon=}
\newcommand{\disteq}{\overset{d}{=}}


% Colors for pgfplots - rgb colors for matplotlib style 'seaborn-colorblind'
\definecolor{color0}{rgb}{0.12156862745098,0.466666666666667,0.705882352941177}
\definecolor{color1}{rgb}{1,0.498039215686275,0.0549019607843137}
\definecolor{color2}{rgb}{0.172549019607843,0.627450980392157,0.172549019607843}
\definecolor{color3}{rgb}{0.83921568627451,0.152941176470588,0.156862745098039}
\definecolor{color4}{rgb}{0.580392156862745,0.403921568627451,0.741176470588235}
\definecolor{color5}{rgb}{0.549019607843137,0.337254901960784,0.294117647058824}
\definecolor{color6}{rgb}{0.890196078431372,0.466666666666667,0.76078431372549}
\definecolor{color7}{rgb}{0.737254901960784,0.741176470588235,0.133333333333333}
\definecolor{color8}{rgb}{0.0901960784313725,0.745098039215686,0.811764705882353}



% ------------------------------------------------------------------
% Citation style as superscript brackets, with postnote working.
% ------------------------------------------------------------------
% \DeclareCiteCommand{\supercite}[\mkbibsuperscript]{\iffieldundef{prenote}{}{\BibliographyWarning{Ignoring prenote argument}}\iffieldundef{postnote}{}{}}{~\bibopenbracket\usebibmacro{citeindex}\usebibmacro{cite}\usebibmacro{postnote}\bibclosebracket}{\supercitedelim}{}
\DeclareCiteCommand{\supercite}[\mkbibsuperscript]
  {\iffieldundef{prenote}
     {}
     {\BibliographyWarning{Ignoring prenote argument}}%
   \iffieldundef{postnote}
     {}
     {\BibliographyWarning{Ignoring postnote argument}}}
  {\usebibmacro{citeindex}%
   \bibopenbracket\usebibmacro{cite}\bibclosebracket}
  {\supercitedelim}
  {}

% ------------------------------------------------------------------
% Python listings: From github.com/olivierverdier/python-latex-highlighting
% ------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}


\RequirePackage{listings}
\RequirePackage{xcolor}

\renewcommand*{\lstlistlistingname}{Code Listings}
\renewcommand*{\lstlistingname}{Code Listing}
\definecolor{gray}{gray}{0.5}
\colorlet{commentcolour}{green!50!black}

\colorlet{stringcolour}{red!60!black}
\colorlet{keywordcolour}{magenta!90!black}
\colorlet{exceptioncolour}{yellow!50!red}
\colorlet{commandcolour}{blue!60!black}
\colorlet{numpycolour}{blue!60!green}
\colorlet{literatecolour}{magenta!90!black}
\colorlet{promptcolour}{green!50!black}
\colorlet{specmethodcolour}{violet}

\newcommand*{\framemargin}{3ex}

\newcommand*{\literatecolour}{\textcolor{literatecolour}}

\newcommand*{\pythonprompt}{\textcolor{promptcolour}{{>}{>}{>}}}

\lstdefinestyle{mypython}{
%\lstset{
%keepspaces=true,
language=python,
showtabs=true,
tab=,
tabsize=2,
basicstyle=\ttfamily\footnotesize,%\setstretch{.5},
stringstyle=\color{stringcolour},
showstringspaces=false,
alsoletter={1234567890},
otherkeywords={\%, \}, \{, \&, \|},
keywordstyle=\color{keywordcolour}\bfseries,
emph={and,break,class,continue,def,yield,del,elif ,else,%
except,exec,finally,for,from,global,if,import,in,%
lambda,not,or,pass,print,raise,return,try,while,assert,with},
emphstyle=\color{blue}\bfseries,
emph={[2]True, False, None},
emphstyle=[2]\color{keywordcolour},
emph={[3]object,type,isinstance,copy,deepcopy,zip,enumerate,reversed,list,set,len,dict,tuple,xrange,append,execfile,real,imag,reduce,str,repr},
emphstyle=[3]\color{commandcolour},
emph={Exception,NameError,IndexError,SyntaxError,TypeError,ValueError,OverflowError,ZeroDivisionError},
emphstyle=\color{exceptioncolour}\bfseries,
%upquote=true,
morecomment=[s]{"""}{"""},
commentstyle=\color{commentcolour}\slshape,
%emph={[4]1, 2, 3, 4, 5, 6, 7, 8, 9, 0},
emph={[4]ode, fsolve, sqrt, exp, sin, cos,arctan, arctan2, arccos, pi,  array, norm, solve, dot, arange, isscalar, max, sum, flatten, shape, reshape, find, any, all, abs, plot, linspace, legend, quad, polyval,polyfit, hstack, concatenate,vstack,column_stack,empty,zeros,ones,rand,vander,grid,pcolor,eig,eigs,eigvals,svd,qr,tan,det,logspace,roll,min,mean,cumsum,cumprod,diff,vectorize,lstsq,cla,eye,xlabel,ylabel,squeeze},
emphstyle=[4]\color{numpycolour},
emph={[5]__init__,__add__,__mul__,__div__,__sub__,__call__,__getitem__,__setitem__,__eq__,__ne__,__nonzero__,__rmul__,__radd__,__repr__,__str__,__get__,__truediv__,__pow__,__name__,__future__,__all__},
emphstyle=[5]\color{specmethodcolour},
emph={[6]assert,yield},
emphstyle=[6]\color{keywordcolour}\bfseries,
emph={[7]range},
emphstyle={[7]\color{keywordcolour}\bfseries},
% emph={[7]self},
% emphstyle=[7]\bfseries,
literate=*%
{:}{{\literatecolour:}}{1}%
{=}{{\literatecolour=}}{1}%
{-}{{\literatecolour-}}{1}%
{+}{{\literatecolour+}}{1}%
{*}{{\literatecolour*}}{1}%
{**}{{\literatecolour{**}}}2%
{/}{{\literatecolour/}}{1}%
{//}{{\literatecolour{//}}}2%
{!}{{\literatecolour!}}{1}%
%{(}{{\literatecolour(}}{1}%
%{)}{{\literatecolour)}}{1}%
{[}{{\literatecolour[}}{1}%
{]}{{\literatecolour]}}{1}%
{<}{{\literatecolour<}}{1}%
{>}{{\literatecolour>}}{1}%
{>>>}{\pythonprompt}{3}%
,%
%aboveskip=.5ex,
frame=trbl,
%frameround=tttt,
%framesep=.3ex,
rulecolor=\color{black!40},
%framexleftmargin=\framemargin,
%framextopmargin=.1ex,
%framexbottommargin=.1ex,
%framexrightmargin=\framemargin,
%framexleftmargin=1mm, framextopmargin=1mm, frame=shadowbox, rulesepcolor=\color{blue},#1
%frame=tb,
backgroundcolor=\color{white},
breakindent=.5\textwidth,frame=single,breaklines=true%
%}
}

\newcommand*{\inputpython}[3]{\lstinputlisting[firstline=#2,lastline=#3,firstnumber=#2,frame=single,breakindent=.5\textwidth,frame=single,breaklines=true,style=mypython]{#1}}

\lstnewenvironment{python}[1][]{\lstset{style=mypython}}{}

\lstdefinestyle{mypythoninline}{
style=mypython,%
basicstyle=\ttfamily,%
keywordstyle=\color{keywordcolour},%
emphstyle={[7]\color{keywordcolour}},%
emphstyle=\color{exceptioncolour},%
literate=*%
{:}{{\literatecolour:}}{2}%
{=}{{\literatecolour=}}{2}%
{-}{{\literatecolour-}}{2}%
{+}{{\literatecolour+}}{2}%
{*}{{\literatecolour*}}2%
{**}{{\literatecolour{**}}}3%
{/}{{\literatecolour/}}{2}%
{//}{{\literatecolour{//}}}{2}%
{!}{{\literatecolour!}}{2}%
%{(}{{\literatecolour(}}{2}%
%{)}{{\literatecolour)}}{2}%
{[}{{\literatecolour[}}{2}%
{]}{{\literatecolour]}}{2}%
{<}{{\literatecolour<}}{2}%
{<=}{{\literatecolour{<=}}}3%
{>}{{\literatecolour>}}{2}%
{>=}{{\literatecolour{>=}}}3%
{==}{{\literatecolour{==}}}3%
{!=}{{\literatecolour{!=}}}3%
{+=}{{\literatecolour{+=}}}3%
{-=}{{\literatecolour{-=}}}3%
{*=}{{\literatecolour{*=}}}3%
{/=}{{\literatecolour{/=}}}3%
%% emphstyle=\color{blue},%
}

\newcommand*{\pyth}{\lstinline[style=mypythoninline]}

\makeatletter
\@ifpackageloaded{babel}
  {\newenvironment{nohyphens}
     {\par\sloppy\exhyphenpenalty=\@M
      \@ifundefined{l@nohyphenation}
        {\language=\@cclv}
        {\hyphenrules{nohyphenation}}%
     }
     {\par
      \@ifundefined{l@nohyphenation}
        {}
        {\endhyphenrules}%
     }
  }
  {\newenvironment{nohyphens}
     {\par\sloppy\exhyphenpenalty=\@M
      \@ifundefined{l@nohyphenation}
        {\language=\@cclv}
        {\language=\l@nohyphenation}%
     }
     {\par}
  }
\makeatother

\ifcsname DeclareUnicodeCharacter\endcsname%
    \DeclareUnicodeCharacter{2212}{-}
\fi%
